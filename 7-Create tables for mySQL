CREATE TABLE Spieler (
	SpielerID int NOT NULL PRIMARY KEY,
	Name varchar(20),
	Vorname varchar(20) NOT NULL,
	Nickname varchar(20) UNIQUE
);

CREATE TABLE Team (
	TeamID int NOT NULL PRIMARY KEY,
	Name varchar(40) NOT NULL UNIQUE
);

CREATE TABLE Wettbewerb (
	WbID int NOT NULL PRIMARY KEY,
	Name varchar(40) NOT NULL UNIQUE
);

CREATE TABLE Unterwettbewerb (
	UnterwbID int NOT NULL PRIMARY KEY,
	WbID int NOT NULL,
	Name varchar(40) UNIQUE,
	Modus varchar(7) NOT NULL CHECK (Modus = 'turnier' OR Modus = 'liga' OR Modus = 'ko'),
	OTN varchar(3) NOT NULL CHECK (OTN = 'ein' OR OTN = 'aus'),
	Start date NOT NULL,
	Ende date,
    CONSTRAINT fk_WbUnterwb FOREIGN KEY (WbID) REFERENCES  Wettbewerb(WbID)
);

CREATE TABLE Spiel (
	SpielID int NOT NULL PRIMARY KEY,
	UnterwbID int NOT NULL,
	Team1ID int,
	Team2ID int,
	SiegerID int,
	Gewertet int NOT NULL DEFAULT 1,
	Datum date,
    CONSTRAINT fk_SpielUnterwb FOREIGN KEY (UnterwbID) REFERENCES Unterwettbewerb(UnterwbID),
    CONSTRAINT fk_SpielTeam1 FOREIGN KEY (Team1ID) REFERENCES Team(TeamID),
    CONSTRAINT fk_SpielTeam2 FOREIGN KEY (Team2ID) REFERENCES Team(TeamID),
    CONSTRAINT fk_SpielSieger FOREIGN KEY (SiegerID) REFERENCES Team(TeamID),
    CONSTRAINT chk_Gewertet CHECK(Gewertet = 0 OR Gewertet = 1)
);

CREATE TABLE Turnierspiel (
	SpielID int NOT NULL,
	Becherueber int CHECK (Becherueber <= 6),
    CONSTRAINT fk_Turnierspiel FOREIGN KEY (SpielID) REFERENCES Spiel(SpielID)
);

CREATE TABLE Ligaspiel (
	SpielID int NOT NULL,
	Spieltag int,
	Spieler1ID int,
	Spieler2ID int,
	Spieler3ID int,
	Spieler4ID int,
	Sp1tref int CHECK (Sp1tref <= 6),
	Sp2tref int CHECK (Sp2tref <= 6),
	Sp3tref int CHECK (Sp3tref <= 6),
	Sp4tref int CHECK (Sp4tref <= 6),
	T1tref int CHECK (T1tref <= 6),
	T2tref int CHECK (T2tref <= 6),
	T1Strafe int CHECK (T1Strafe <= 6),
	T2Strafe int CHECK (T2Strafe <= 6),
    CONSTRAINT fk_Ligaspiel FOREIGN KEY (SpielID) REFERENCES Spiel(SpielID),
    CONSTRAINT fk_LigaSpieler1 FOREIGN KEY (Spieler1ID) REFERENCES Spieler(SpielerID),
    CONSTRAINT fk_LigaSpieler2 FOREIGN KEY (Spieler2ID) REFERENCES Spieler(SpielerID),
    CONSTRAINT fk_LigaSpieler3 FOREIGN KEY (Spieler3ID) REFERENCES Spieler(SpielerID),
    CONSTRAINT fk_LigaSpieler4 FOREIGN KEY (Spieler4ID) REFERENCES Spieler(SpielerID)    
);

CREATE TABLE KOspiel (
	SpielID int NOT NULL,
	NFWinnerID int,
	NFLoserID int,
	Bestofwhat int DEFAULT 1,
	T1Erg int,
	T2Erg int,
    CONSTRAINT fk_KOspiel FOREIGN KEY (SpielID) REFERENCES Spiel(SpielID),
    CONSTRAINT fk_NWwin FOREIGN KEY (NFWinnerID) REFERENCES Spiel(SpielID),
    CONSTRAINT fk_NFLos FOREIGN KEY (NFLoserID) REFERENCES Spiel(SpielID)
);

CREATE TABLE Teilgenommen (
	UnterwbID int NOT NULL,
	TeamID int NOT NULL,
	SpielerID int NOT NULL, 
    CONSTRAINT fk_TGUnterwb FOREIGN KEY (UnterwbID) REFERENCES Unterwettbewerb(UnterwbID),
    CONSTRAINT fk_TGTeam FOREIGN KEY (TeamID) REFERENCES Team(TeamID),
	CONSTRAINT fk_TGSpieler FOREIGN KEY (SpielerID) REFERENCES Spieler(SpielerID)
);                                      
